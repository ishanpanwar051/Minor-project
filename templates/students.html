{% extends "layout.html" %}

{% block content %}
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2">Student Directory</h1>
    <div class="btn-toolbar mb-2 mb-md-0">
        <form class="d-flex" action="{{ url_for('main.students') }}" method="GET">
            <select name="risk" class="form-select me-2" onchange="this.form.submit()">
                <option value="">All Risk Levels</option>
                <option value="High" {% if request.args.get('risk') == 'High' %}selected{% endif %}>High Risk</option>
                <option value="Medium" {% if request.args.get('risk') == 'Medium' %}selected{% endif %}>Medium Risk</option>
                <option value="Low" {% if request.args.get('risk') == 'Low' %}selected{% endif %}>Low Risk</option>
            </select>
            <input class="form-control me-2" type="search" name="search" placeholder="Search name/ID" value="{{ request.args.get('search', '') }}">
            <button class="btn btn-outline-primary" type="submit">Search</button>
        </form>
    </div>
</div>

<div class="table-responsive bg-white rounded shadow-sm">
    <table class="table table-striped table-hover align-middle mb-0">
        <thead class="table-dark">
            <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Semester</th>
                <th>Risk Level</th>
                <th>Risk Score</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            {% for student in students %}
            <tr>
                <td>{{ student.student_id }}</td>
                <td>
                    <div class="d-flex align-items-center">
                        <div class="ms-2">
                            <p class="fw-bold mb-1">{{ student.full_name() }}</p>
                            <p class="text-muted mb-0">{{ student.email }}</p>
                        </div>
                    </div>
                </td>
                <td>{{ student.semester }}</td>
                <td>
                    {% if student.risk_profile.risk_level == 'High' %}
                        <span class="badge bg-danger rounded-pill">High</span>
                    {% elif student.risk_profile.risk_level == 'Medium' %}
                        <span class="badge bg-warning text-dark rounded-pill">Medium</span>
                    {% else %}
                        <span class="badge bg-success rounded-pill">Low</span>
                    {% endif %}
                </td>
                <td>
                    <div class="progress" style="height: 5px; width: 100px;">
                        <div class="progress-bar {% if student.risk_profile.risk_level == 'High' %}bg-danger{% elif student.risk_profile.risk_level == 'Medium' %}bg-warning{% else %}bg-success{% endif %}" 
                             role="progressbar" 
                             style="width: {{ student.risk_profile.risk_score }}%" 
                             aria-valuenow="{{ student.risk_profile.risk_score }}" 
                             aria-valuemin="0" 
                             aria-valuemax="100"></div>
                    </div>
                    <small>{{ student.risk_profile.risk_score }}%</small>
                </td>
                <td>
                    <a href="{{ url_for('main.student_detail', id=student.id) }}" class="btn btn-sm btn-outline-primary">View Details</a>
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="6" class="text-center py-4">No students found.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
